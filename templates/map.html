{% extends "base.html" %}
{% block title %}Map • Gender Hotspot Maps{% endblock %}

{% block head_extra %}
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
{% endblock %}

{% block content %}
<section class="section">
  <h1>Map</h1>
  <p class="muted">Filter by country, sector, and dataset then refresh.</p>

  <!-- Filters row -->
  <div class="filters">
    <div class="filters__item">
      <label for="countrySelect">Country:</label>
      <select id="countrySelect">
        <option value="__all__">All</option>
      </select>
    </div>

    <div class="filters__item">
      <label for="sectorSelect">Sector:</label>
      <select id="sectorSelect">
        <option value="__all__">All</option>
      </select>
    </div>

    <div class="filters__item">
      <label for="metricSelect">Map Data:</label>
      <select id="metricSelect">
        <option value="risk_level">Risk Level</option>
        <option value="vulnerability_score">Vulnerability Score</option>
        <option value="gender_hotspot_score">Gender Hotspot Score</option>
      </select>
    </div>

    <button id="refreshBtn" class="btn btn--ghost" type="button">Refresh</button>
  </div>

  <div id="map" class="map"></div>
</section>

<!-- District Panel (below map) -->
<section class="section" id="districtPanel" style="display:none;">
  <div class="districtHeader">
    <div>
      <h2 class="districtTitle">District Data (<span id="districtCount">0</span> shown)</h2>
      <p class="muted" id="districtSub">Select a country to load districts.</p>
    </div>

    <div class="districtTools">
      <input id="districtSearch" class="districtSearch" type="search" placeholder="Search districts..." />
      <select id="districtSort" class="districtSort">
        <option value="name_asc">Sort by Name</option>
        <option value="score_desc">Sort by Score (High → Low)</option>
        <option value="score_asc">Sort by Score (Low → High)</option>
        <option value="risk_asc">Sort by Risk (Low → High)</option>
        <option value="risk_desc">Sort by Risk (High → Low)</option>
      </select>
      <button id="scoreInfoBtn" class="btn" type="button">Score Info</button>
    </div>
  </div>

  <div id="districtGrid" class="districtGrid"></div>
</section>

<!-- Score Info Modal -->
<div id="scoreModal" class="modal" style="display:none;">
  <div class="modal__backdrop" id="scoreModalClose"></div>
  <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="scoreModalTitle">
    <div class="modal__head">
      <h3 id="scoreModalTitle">Score Info</h3>
      <button class="modal__x" id="scoreModalX" type="button">✕</button>
    </div>
    <div class="modal__body" id="scoreModalBody"></div>
  </div>
</div>
{% endblock %}


{% block body_scripts %}
  <!-- 1) Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- 2) Google Maps JS API (must load before GoogleMutant) -->
  <script
    async
    defer
    src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&v=weekly"
  ></script>

  <!-- 3) Leaflet GoogleMutant plugin (connects Google Maps to Leaflet) -->
  <script
    src="https://cdn.jsdelivr.net/npm/leaflet.gridlayer.googlemutant@0.15.0/dist/Leaflet.GoogleMutant.js"
  ></script>

  <!-- 4) Your map logic -->
  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}
